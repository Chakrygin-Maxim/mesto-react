{"ast":null,"code":"import _slicedToArray from\"C:/Users/chakrygin/dev/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Route,Switch,Redirect,useHistory}from\"react-router-dom\";import{useState,useEffect}from\"react\";import{CurrentUserContext}from\"../context/CurrentUserContext\";import api from\"../utils/api.js\";import Header from\"./Header\";import Main from\"./Main\";import Footer from\"./Footer\";import EditProfilePopup from\"./EditProfilePopup\";import AddPlacePopup from\"./AddPlacePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import ImagePopup from\"./ImagePopup\";import ProtectedRoute from\"./ProtectedRoute\";import Login from\"./Login\";import Register from\"./Register\";import SuccessTooltip from\"./SuccessTooltip\";import ErrorTooltip from\"./ErrorTooltip\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function App(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isEditProfilePopupOpen=_useState2[0],setEditProfilePopupOpen=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isAddPlacePopupOpen=_useState4[0],setAddPlacePopupOpen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isEditAvatarPopupOpen=_useState6[0],setIsEditAvatarPopupOpen=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isSuccessTooltipOpen=_useState8[0],setIsSuccessTooltipOpen=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isErrorTooltipOpen=_useState10[0],setIsErrorTooltipOpen=_useState10[1];var _useState11=useState({link:\"\",name:\"\"}),_useState12=_slicedToArray(_useState11,2),selectedCard=_useState12[0],setSelectedCard=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),cards=_useState14[0],setCards=_useState14[1];var _useState15=useState({_id:\"\",name:\"\",about:\"\",avatar:\"\"}),_useState16=_slicedToArray(_useState15,2),currentUser=_useState16[0],setCurrentUser=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),loggedIn=_useState18[0],setLoggedIn=_useState18[1];var _useState19=useState(\"\"),_useState20=_slicedToArray(_useState19,2),userMail=_useState20[0],setUserMail=_useState20[1];var history=useHistory();// установка данных пользователя и начальные карточки при монтировании\nuseEffect(function(){Promise.all([api.getUserInfo(),api.getInitialCards()]).then(function(_ref){var _ref2=_slicedToArray(_ref,2),userData=_ref2[0],initialCards=_ref2[1];setUserInfo(userData);setCards(initialCards);}).catch(function(err){console.log(\"Error \".concat(err));});},[]);useEffect(function(){handleCheckToken();},[history]);function handleCheckToken(){var jwt=localStorage.getItem(\"jwt\");if(jwt){api.checkToken(jwt).then(function(res){if(res){setUserMail(res.data.email);setUserInfo(res.data);setLoggedIn(true);history.push(\"/\");}else{localStorage.removeItem(\"jwt\");}}).catch(function(err){setIsErrorTooltipOpen(true);if(err.status===400){console.log(\"\\u041A\\u043E\\u0434 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0438: \".concat(err.status,\", \\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \\u0422\\u043E\\u043A\\u0435\\u043D \\u043D\\u0435 \\u043F\\u0435\\u0440\\u0435\\u0434\\u0430\\u043D \\u0438\\u043B\\u0438 \\u043F\\u0435\\u0440\\u0435\\u0434\\u0430\\u043D \\u043D\\u0435 \\u0432 \\u0442\\u043E\\u043C \\u0444\\u043E\\u0440\\u043C\\u0430\\u0442\\u0435\"));}else if(err.status===401){console.log(\"\\u041A\\u043E\\u0434 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0438: \".concat(err.status,\", \\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \\u041F\\u0435\\u0440\\u0435\\u0434\\u0430\\u043D\\u043D\\u044B\\u0439 \\u0442\\u043E\\u043A\\u0435\\u043D \\u043D\\u0435\\u043A\\u043E\\u0440\\u0440\\u0435\\u043A\\u0442\\u0435\\u043D\"));}else{console.log(\"\\u041A\\u043E\\u0434 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0438: \".concat(err.status,\", \\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \").concat(err.statusText));}});}}// установка данных пользователя\nfunction setUserInfo(data){var _id=data._id,name=data.name,about=data.about,avatar=data.avatar;setCurrentUser({_id:_id,name:name,about:about,avatar:avatar});}// открытие popup Аватара\nfunction handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);}// открытие popup Профиля пользователя\nfunction handleEditProfileClick(){setEditProfilePopupOpen(true);}// открытие popup Нового места\nfunction handleAddPlaceClick(){setAddPlacePopupOpen(true);}// открытие popup с местом\nfunction handleCardClick(card){var link=card.link,name=card.name;setSelectedCard({link:link,name:name});}// обновление данных пользователя\nfunction handleUpdateUser(data){return api.updateUserInfo(data.name,data.about).then(function(userData){setUserInfo(userData);closeAllPopups();}).catch(function(err){console.log(\"Error \".concat(err));});}// обновление аватара пользователя\nfunction handleUpdateAvatar(avatar){return api.updateAvatar(avatar).then(function(userData){setUserInfo(userData);closeAllPopups();}).catch(function(err){console.log(\"Error \".concat(err));});}// добавление новой карточки\nfunction handleAddPlaceSubmit(inputValues){return api.addCard(inputValues.cardName,inputValues.link).then(function(data){var newCards=cards.slice();newCards.unshift(data);setCards(newCards);closeAllPopups();}).catch(function(err){console.log(\"Error \".concat(err));});}// установка-снятие лайка картинки\nfunction handleCardLike(card){var isLiked=card.likes.some(function(i){return i===currentUser._id;});api.changeLikeCardStatus(card._id,!isLiked).then(function(newCard){var newCards=cards.map(function(c){return c._id===card._id?newCard:c;});setCards(newCards);}).catch(function(err){console.log(\"Error \".concat(err));});}// удаление карточки\nfunction handleCardDelete(cardId){return api.deleteCard(cardId).then(function(data){var currentCards=cards.filter(function(item){return item._id!==cardId;});setCards(currentCards);return data;}).catch(function(err){console.log(\"Error \".concat(err));});}// логин сотрудника на сайте\nfunction handleLoginSubmit(mail,password){return api.authorize(mail,password).then(function(res){if(res.token){localStorage.setItem(\"jwt\",res.token);setUserMail(mail);setLoggedIn(true);history.push(\"/\");}else{setIsErrorTooltipOpen(true);}}).catch(function(err){setIsErrorTooltipOpen(true);if(err.status===400){console.log(\"\\u041A\\u043E\\u0434 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0438: \".concat(err.status,\", \\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \\u043D\\u0435 \\u043F\\u0435\\u0440\\u0435\\u0434\\u0430\\u043D\\u043E \\u043E\\u0434\\u043D\\u043E \\u0438\\u0437 \\u043F\\u043E\\u043B\\u0435\\u0439\"));}else if(err.status===401){console.log(\"\\u041A\\u043E\\u0434 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0438: \".concat(err.status,\", \\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044C \\u0441 email \\u043D\\u0435 \\u043D\\u0430\\u0439\\u0434\\u0435\\u043D\"));}else{console.log(\"\\u041A\\u043E\\u0434 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0438: \".concat(err.status,\", \\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \").concat(err.statusText));}});//\n}// регистрация пользователя на сайте\nfunction handleRegisterSubmit(mail,password){api.register(mail,password).then(function(res){if(res.data){history.push(\"/signin\");setIsSuccessTooltipOpen(true);}else{setIsErrorTooltipOpen(true);}}).catch(function(err){setIsErrorTooltipOpen(true);if(err.status===400){console.log(\"\\u041A\\u043E\\u0434 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0438: \".concat(err.status,\", \\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \\u043D\\u0435 \\u043F\\u0435\\u0440\\u0435\\u0434\\u0430\\u043D\\u043E \\u043E\\u0434\\u043D\\u043E \\u0438\\u0437 \\u043F\\u043E\\u043B\\u0435\\u0439\"));}else{console.log(\"\\u041A\\u043E\\u0434 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0438: \".concat(err.status,\", \\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \").concat(err.statusText));}});}// логаут с сайта\nfunction handleLogout(){setLoggedIn(false);setUserMail(\"\");localStorage.removeItem(\"jwt\");history.push(\"/signin\");}// закрывает все popup\nfunction closeAllPopups(){setIsEditAvatarPopupOpen(false);setEditProfilePopupOpen(false);setAddPlacePopupOpen(false);setIsSuccessTooltipOpen(false);setIsErrorTooltipOpen(false);setSelectedCard({link:\"\",name:\"\"});}return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsx(Header,{loggedIn:loggedIn,userMail:userMail,onLogoutClick:handleLogout}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/\",component:Main,loggedIn:loggedIn,cards:cards,onCardLike:handleCardLike,onCardDelete:handleCardDelete,onEditAvatarClick:handleEditAvatarClick,onEditProfileClick:handleEditProfileClick,onAddPlaceClick:handleAddPlaceClick,onCardClick:handleCardClick}),/*#__PURE__*/_jsx(Route,{path:\"/signup\",children:/*#__PURE__*/_jsx(Register,{onSubmitButton:handleRegisterSubmit})}),/*#__PURE__*/_jsx(Route,{path:\"/signin\",children:/*#__PURE__*/_jsx(Login,{onSubmitButton:handleLoginSubmit})}),/*#__PURE__*/_jsx(Route,{children:loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/signin\"})})]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups}),/*#__PURE__*/_jsx(SuccessTooltip,{isOpen:isSuccessTooltipOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(ErrorTooltip,{isOpen:isErrorTooltipOpen,onClose:closeAllPopups})]})});}export default App;","map":{"version":3,"sources":["C:/Users/chakrygin/dev/react-mesto-api-full/frontend/src/components/App.js"],"names":["Route","Switch","Redirect","useHistory","useState","useEffect","CurrentUserContext","api","Header","Main","Footer","EditProfilePopup","AddPlacePopup","EditAvatarPopup","ImagePopup","ProtectedRoute","Login","Register","SuccessTooltip","ErrorTooltip","App","isEditProfilePopupOpen","setEditProfilePopupOpen","isAddPlacePopupOpen","setAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isSuccessTooltipOpen","setIsSuccessTooltipOpen","isErrorTooltipOpen","setIsErrorTooltipOpen","link","name","selectedCard","setSelectedCard","cards","setCards","_id","about","avatar","currentUser","setCurrentUser","loggedIn","setLoggedIn","userMail","setUserMail","history","Promise","all","getUserInfo","getInitialCards","then","userData","initialCards","setUserInfo","catch","err","console","log","handleCheckToken","jwt","localStorage","getItem","checkToken","res","data","email","push","removeItem","status","statusText","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick","card","handleUpdateUser","updateUserInfo","closeAllPopups","handleUpdateAvatar","updateAvatar","handleAddPlaceSubmit","inputValues","addCard","cardName","newCards","slice","unshift","handleCardLike","isLiked","likes","some","i","changeLikeCardStatus","newCard","map","c","handleCardDelete","cardId","deleteCard","currentCards","filter","item","handleLoginSubmit","mail","password","authorize","token","setItem","handleRegisterSubmit","register","handleLogout"],"mappings":"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","sourcesContent":["import { Route, Switch, Redirect, useHistory } from \"react-router-dom\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { CurrentUserContext } from \"../context/CurrentUserContext\";\r\nimport api from \"../utils/api.js\";\r\nimport Header from \"./Header\";\r\nimport Main from \"./Main\";\r\nimport Footer from \"./Footer\";\r\nimport EditProfilePopup from \"./EditProfilePopup\";\r\nimport AddPlacePopup from \"./AddPlacePopup\";\r\nimport EditAvatarPopup from \"./EditAvatarPopup\";\r\nimport ImagePopup from \"./ImagePopup\";\r\nimport ProtectedRoute from \"./ProtectedRoute\";\r\nimport Login from \"./Login\";\r\nimport Register from \"./Register\";\r\nimport SuccessTooltip from \"./SuccessTooltip\";\r\nimport ErrorTooltip from \"./ErrorTooltip\";\r\n\r\nfunction App() {\r\n  const [isEditProfilePopupOpen, setEditProfilePopupOpen] = useState(false);\r\n  const [isAddPlacePopupOpen, setAddPlacePopupOpen] = useState(false);\r\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = useState(false);\r\n  const [isSuccessTooltipOpen, setIsSuccessTooltipOpen] = useState(false);\r\n  const [isErrorTooltipOpen, setIsErrorTooltipOpen] = useState(false);\r\n  const [selectedCard, setSelectedCard] = useState({ link: \"\", name: \"\" });\r\n  const [cards, setCards] = useState([]);\r\n  const [currentUser, setCurrentUser] = useState({\r\n    _id: \"\",\r\n    name: \"\",\r\n    about: \"\",\r\n    avatar: \"\",\r\n  });\r\n  const [loggedIn, setLoggedIn] = useState(false);\r\n  const [userMail, setUserMail] = useState(\"\");\r\n\r\n  const history = useHistory();\r\n\r\n  // установка данных пользователя и начальные карточки при монтировании\r\n  useEffect(() => {\r\n    Promise.all([api.getUserInfo(), api.getInitialCards()])\r\n      .then(([userData, initialCards]) => {\r\n        setUserInfo(userData);\r\n        setCards(initialCards);\r\n      })\r\n      .catch((err) => {\r\n        console.log(`Error ${err}`);\r\n      });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    handleCheckToken();\r\n  }, [history]);\r\n\r\n  function handleCheckToken() {\r\n    const jwt = localStorage.getItem(\"jwt\");\r\n\r\n    if (jwt) {\r\n      api\r\n        .checkToken(jwt)\r\n        .then((res) => {\r\n          if (res) {\r\n            setUserMail(res.data.email);\r\n            setUserInfo(res.data);\r\n            setLoggedIn(true);\r\n            history.push(\"/\");\r\n          } else {\r\n            localStorage.removeItem(\"jwt\");\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          setIsErrorTooltipOpen(true);\r\n          if (err.status === 400) {\r\n            console.log(\r\n              `Код ошибки: ${err.status}, Ошибка: Токен не передан или передан не в том формате`\r\n            );\r\n          } else if (err.status === 401) {\r\n            console.log(\r\n              `Код ошибки: ${err.status}, Ошибка: Переданный токен некорректен`\r\n            );\r\n          } else {\r\n            console.log(`Код ошибки: ${err.status}, Ошибка: ${err.statusText}`);\r\n          }\r\n        });\r\n    }\r\n  }\r\n\r\n  // установка данных пользователя\r\n  function setUserInfo(data) {\r\n    const { _id, name, about, avatar } = data;\r\n    setCurrentUser({ _id, name, about, avatar });\r\n  }\r\n\r\n  // открытие popup Аватара\r\n  function handleEditAvatarClick() {\r\n    setIsEditAvatarPopupOpen(true);\r\n  }\r\n  // открытие popup Профиля пользователя\r\n  function handleEditProfileClick() {\r\n    setEditProfilePopupOpen(true);\r\n  }\r\n  // открытие popup Нового места\r\n  function handleAddPlaceClick() {\r\n    setAddPlacePopupOpen(true);\r\n  }\r\n\r\n  // открытие popup с местом\r\n  function handleCardClick(card) {\r\n    const { link, name } = card;\r\n    setSelectedCard({ link, name });\r\n  }\r\n\r\n  // обновление данных пользователя\r\n  function handleUpdateUser(data) {\r\n    return api\r\n      .updateUserInfo(data.name, data.about)\r\n      .then((userData) => {\r\n        setUserInfo(userData);\r\n        closeAllPopups();\r\n      })\r\n      .catch((err) => {\r\n        console.log(`Error ${err}`);\r\n      });\r\n  }\r\n\r\n  // обновление аватара пользователя\r\n  function handleUpdateAvatar(avatar) {\r\n    return api\r\n      .updateAvatar(avatar)\r\n      .then((userData) => {\r\n        setUserInfo(userData);\r\n        closeAllPopups();\r\n      })\r\n      .catch((err) => {\r\n        console.log(`Error ${err}`);\r\n      });\r\n  }\r\n\r\n  // добавление новой карточки\r\n  function handleAddPlaceSubmit(inputValues) {\r\n    return api\r\n      .addCard(inputValues.cardName, inputValues.link)\r\n      .then((data) => {\r\n        const newCards = cards.slice();\r\n        newCards.unshift(data);\r\n        setCards(newCards);\r\n        closeAllPopups();\r\n      })\r\n      .catch((err) => {\r\n        console.log(`Error ${err}`);\r\n      });\r\n  }\r\n\r\n  // установка-снятие лайка картинки\r\n  function handleCardLike(card) {\r\n    const isLiked = card.likes.some((i) => i === currentUser._id);\r\n\r\n    api\r\n      .changeLikeCardStatus(card._id, !isLiked)\r\n      .then((newCard) => {\r\n        const newCards = cards.map((c) => (c._id === card._id ? newCard : c));\r\n        setCards(newCards);\r\n      })\r\n      .catch((err) => {\r\n        console.log(`Error ${err}`);\r\n      });\r\n  }\r\n\r\n  // удаление карточки\r\n  function handleCardDelete(cardId) {\r\n    return api\r\n      .deleteCard(cardId)\r\n      .then((data) => {\r\n        const currentCards = cards.filter((item) => {\r\n          return item._id !== cardId;\r\n        });\r\n        setCards(currentCards);\r\n        return data;\r\n      })\r\n      .catch((err) => {\r\n        console.log(`Error ${err}`);\r\n      });\r\n  }\r\n\r\n  // логин сотрудника на сайте\r\n  function handleLoginSubmit(mail, password) {\r\n    return api\r\n      .authorize(mail, password)\r\n      .then((res) => {\r\n        if (res.token) {\r\n          localStorage.setItem(\"jwt\", res.token);\r\n          setUserMail(mail);\r\n          setLoggedIn(true);\r\n          history.push(\"/\");\r\n        } else {\r\n          setIsErrorTooltipOpen(true);\r\n        }\r\n      })\r\n      .catch((err) => {\r\n        setIsErrorTooltipOpen(true);\r\n        if (err.status === 400) {\r\n          console.log(\r\n            `Код ошибки: ${err.status}, Ошибка: не передано одно из полей`\r\n          );\r\n        } else if (err.status === 401) {\r\n          console.log(\r\n            `Код ошибки: ${err.status}, Ошибка: пользователь с email не найден`\r\n          );\r\n        } else {\r\n          console.log(`Код ошибки: ${err.status}, Ошибка: ${err.statusText}`);\r\n        }\r\n      });\r\n    //\r\n  }\r\n\r\n  // регистрация пользователя на сайте\r\n  function handleRegisterSubmit(mail, password) {\r\n    api\r\n      .register(mail, password)\r\n      .then((res) => {\r\n        if (res.data) {\r\n          history.push(\"/signin\");\r\n          setIsSuccessTooltipOpen(true);\r\n        } else {\r\n          setIsErrorTooltipOpen(true);\r\n        }\r\n      })\r\n      .catch((err) => {\r\n        setIsErrorTooltipOpen(true);\r\n        if (err.status === 400) {\r\n          console.log(\r\n            `Код ошибки: ${err.status}, Ошибка: не передано одно из полей`\r\n          );\r\n        } else {\r\n          console.log(`Код ошибки: ${err.status}, Ошибка: ${err.statusText}`);\r\n        }\r\n      });\r\n  }\r\n\r\n  // логаут с сайта\r\n  function handleLogout() {\r\n    setLoggedIn(false);\r\n    setUserMail(\"\");\r\n    localStorage.removeItem(\"jwt\");\r\n    history.push(\"/signin\");\r\n  }\r\n\r\n  // закрывает все popup\r\n  function closeAllPopups() {\r\n    setIsEditAvatarPopupOpen(false);\r\n    setEditProfilePopupOpen(false);\r\n    setAddPlacePopupOpen(false);\r\n    setIsSuccessTooltipOpen(false);\r\n    setIsErrorTooltipOpen(false);\r\n    setSelectedCard({ link: \"\", name: \"\" });\r\n  }\r\n  return (\r\n    <>\r\n      <CurrentUserContext.Provider value={currentUser}>\r\n        <Header\r\n          loggedIn={loggedIn}\r\n          userMail={userMail}\r\n          onLogoutClick={handleLogout}\r\n        />\r\n        <Switch>\r\n          <ProtectedRoute\r\n            exact\r\n            path=\"/\"\r\n            component={Main}\r\n            loggedIn={loggedIn}\r\n            cards={cards}\r\n            onCardLike={handleCardLike}\r\n            onCardDelete={handleCardDelete}\r\n            onEditAvatarClick={handleEditAvatarClick}\r\n            onEditProfileClick={handleEditProfileClick}\r\n            onAddPlaceClick={handleAddPlaceClick}\r\n            onCardClick={handleCardClick}\r\n          />\r\n\r\n          <Route path=\"/signup\">\r\n            <Register onSubmitButton={handleRegisterSubmit} />\r\n          </Route>\r\n\r\n          <Route path=\"/signin\">\r\n            <Login onSubmitButton={handleLoginSubmit} />\r\n          </Route>\r\n          <Route>\r\n            {loggedIn ? <Redirect to=\"/\" /> : <Redirect to=\"/signin\" />}\r\n          </Route>\r\n        </Switch>\r\n        <Footer />\r\n        <EditProfilePopup\r\n          isOpen={isEditProfilePopupOpen}\r\n          onClose={closeAllPopups}\r\n          onUpdateUser={handleUpdateUser}\r\n        />\r\n        <AddPlacePopup\r\n          isOpen={isAddPlacePopupOpen}\r\n          onClose={closeAllPopups}\r\n          onAddPlace={handleAddPlaceSubmit}\r\n        />\r\n        <EditAvatarPopup\r\n          isOpen={isEditAvatarPopupOpen}\r\n          onClose={closeAllPopups}\r\n          onUpdateAvatar={handleUpdateAvatar}\r\n        />\r\n        <ImagePopup card={selectedCard} onClose={closeAllPopups} />\r\n        <SuccessTooltip\r\n          isOpen={isSuccessTooltipOpen}\r\n          onClose={closeAllPopups}\r\n        />\r\n        <ErrorTooltip isOpen={isErrorTooltipOpen} onClose={closeAllPopups} />\r\n      </CurrentUserContext.Provider>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}